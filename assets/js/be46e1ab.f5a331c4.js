"use strict";(self.webpackChunksonic_red_dragon_docs=self.webpackChunksonic_red_dragon_docs||[]).push([[8521],{6298:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"contracts/randomness/cross-chain-architecture","title":"Cross-Chain Randomness Architecture","description":"OmniDragon implements a pioneering cross-chain randomness architecture that leverages multiple blockchains and randomness sources to create a secure, reliable, and manipulation-resistant system for generating verifiable randomness.","source":"@site/docs/contracts/randomness/cross-chain-architecture.md","sourceDirName":"contracts/randomness","slug":"/contracts/randomness/cross-chain-architecture","permalink":"/contracts/randomness/cross-chain-architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/wenakita/sonicreddragon-docs/edit/main/docs/contracts/randomness/cross-chain-architecture.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"contracts","previous":{"title":"VRF Utility Library","permalink":"/contracts/randomness/vrf-utils"}}');var i=s(4848),t=s(8453);const a={sidebar_position:6},o="Cross-Chain Randomness Architecture",c={},l=[{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Why Cross-Chain Randomness?",id:"why-cross-chain-randomness",level:2},{value:"Key Components by Chain",id:"key-components-by-chain",level:2},{value:"Sonic Chain Components",id:"sonic-chain-components",level:3},{value:"Arbitrum Chain Components",id:"arbitrum-chain-components",level:3},{value:"Cross-Chain Infrastructure",id:"cross-chain-infrastructure",level:3},{value:"Cross-Chain Message Flow",id:"cross-chain-message-flow",level:2},{value:"LayerZero Integration",id:"layerzero-integration",level:2},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Chain-Level Security",id:"chain-level-security",level:3},{value:"Randomness Security",id:"randomness-security",level:3},{value:"Fallback Mechanisms",id:"fallback-mechanisms",level:3},{value:"Gas and Fee Considerations",id:"gas-and-fee-considerations",level:2},{value:"Integration Example",id:"integration-example",level:2},{value:"Deployment Pipeline",id:"deployment-pipeline",level:2},{value:"Monitoring and Maintenance",id:"monitoring-and-maintenance",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"cross-chain-randomness-architecture",children:"Cross-Chain Randomness Architecture"})}),"\n",(0,i.jsx)(n.p,{children:"OmniDragon implements a pioneering cross-chain randomness architecture that leverages multiple blockchains and randomness sources to create a secure, reliable, and manipulation-resistant system for generating verifiable randomness."}),"\n",(0,i.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,i.jsx)(n.p,{children:"The cross-chain randomness architecture spans multiple blockchains, using LayerZero for secure messaging between chains:"}),"\n",(0,i.jsx)(n.mermaid,{value:'flowchart TB\n    subgraph "Sonic Chain"\n        A[OmniDragon Token] --\x3e B[SwapTriggerOracle]\n        B --\x3e C[OmniDragonVRFConsumer]\n        C --\x3e D[ChainlinkVRFIntegrator]\n        C --\x3e E[drand Integrator]\n        C --\x3e F[Other Integrators]\n        D --\x3e G[LayerZero Endpoint]\n    end\n    \n    subgraph "LayerZero Network"\n        G <--\x3e H[Cross-Chain Messaging]\n        H <--\x3e I[LayerZero Endpoint]\n    end\n    \n    subgraph "Arbitrum Chain"\n        I --\x3e J[ArbitrumVRFRequester]\n        J --\x3e K[Chainlink VRF Coordinator]\n        K --\x3e L[VRF Fulfillment]\n        L --\x3e J\n        J --\x3e I\n    end'}),"\n",(0,i.jsx)(n.h2,{id:"why-cross-chain-randomness",children:"Why Cross-Chain Randomness?"}),"\n",(0,i.jsx)(n.p,{children:"OmniDragon's cross-chain approach to randomness offers several advantages:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Chain-Specific Strengths"}),": Leverages specialized services on different chains (like Chainlink VRF on Arbitrum)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Security Diversification"}),": Distributes trust across multiple blockchain ecosystems"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Attack Resistance"}),": Requires an attacker to compromise multiple chains simultaneously"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Provider Diversity"}),": Combines different randomness generation methods (BLS signatures, VRFs, etc.)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Latency Optimization"}),": Can prioritize faster sources while using slower ones for verification"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"key-components-by-chain",children:"Key Components by Chain"}),"\n",(0,i.jsx)(n.h3,{id:"sonic-chain-components",children:"Sonic Chain Components"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"OmniDragonVRFConsumer"}),": Aggregates randomness from multiple sources"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ChainlinkVRFIntegrator"}),": Interfaces with Arbitrum's Chainlink VRF via LayerZero"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"drand Integrator"}),": Connects to the drand network for additional randomness"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Other Integrators"}),": Pluggable architecture for additional randomness sources"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"SwapTriggerOracle"}),": Initiates lottery entries based on token swaps"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"arbitrum-chain-components",children:"Arbitrum Chain Components"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ArbitrumVRFRequester"}),": Receives requests from Sonic and interacts with Chainlink"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Chainlink VRF Coordinator"}),": Provides verifiable randomness on Arbitrum"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"VRF Consumer Contract"}),": Processes Chainlink VRF responses"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"cross-chain-infrastructure",children:"Cross-Chain Infrastructure"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"LayerZero Protocol"}),": Provides secure message passing between chains"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"LayerZero Endpoints"}),": Chain-specific entry points for cross-chain messaging"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Message Verification"}),": Ensures messages come from trusted sources"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Fee Management"}),": Handles gas costs across different chains"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"cross-chain-message-flow",children:"Cross-Chain Message Flow"}),"\n",(0,i.jsx)(n.p,{children:"The cross-chain randomness flow works as follows:"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant User\n    participant Token as OmniDragon Token\n    participant Oracle as SwapTriggerOracle\n    participant Consumer as OmniDragonVRFConsumer\n    participant Integrator as ChainlinkVRFIntegrator\n    participant LZ1 as LayerZero (Sonic)\n    participant LZ2 as LayerZero (Arbitrum)\n    participant Requester as ArbitrumVRFRequester\n    participant Chainlink as Chainlink VRF\n    \n    User->>Token: Buy/Transfer/Swap\n    Token->>Oracle: Process transaction\n    \n    Note over Oracle: Calculate win probability\n    \n    Oracle->>Consumer: Request randomness\n    activate Consumer\n    \n    Consumer->>Integrator: Request Chainlink randomness\n    activate Integrator\n    \n    Integrator->>Integrator: Store request ID\n    Integrator->>LZ1: Send cross-chain message\n    \n    LZ1->>LZ2: Relay message\n    \n    LZ2->>Requester: lzReceive()\n    activate Requester\n    \n    Requester->>Requester: Store request mapping\n    Requester->>Chainlink: requestRandomWords()\n    \n    Note over Chainlink: Generate VRF\n    \n    Chainlink->>Requester: fulfillRandomWords()\n    \n    Requester->>LZ2: Send result back\n    deactivate Requester\n    \n    LZ2->>LZ1: Relay response\n    \n    LZ1->>Integrator: lzReceive()\n    \n    Integrator->>Consumer: fulfillRandomness()\n    deactivate Integrator\n    \n    Consumer->>Consumer: Aggregate with other sources\n    Consumer->>Oracle: Provide final randomness\n    deactivate Consumer\n    \n    Oracle->>Oracle: Determine winner\n    \n    alt User wins\n        Oracle->>User: Trigger jackpot win\n    else User doesn't win\n        Oracle->>Oracle: No action\n    end"}),"\n",(0,i.jsx)(n.h2,{id:"layerzero-integration",children:"LayerZero Integration"}),"\n",(0,i.jsx)(n.p,{children:"LayerZero provides the secure cross-chain messaging backbone:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Message Passing"}),": Serialized request and response payloads"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Source Verification"}),": Ensures messages come from trusted contracts"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ultra Light Nodes (ULNs)"}),": Verify block headers for secure cross-chain communication"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Relayers"}),": Transmit messages between chains"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Endpoints"}),": Chain-specific entry points that validate and process messages"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,i.jsx)(n.p,{children:"The cross-chain randomness system implements multiple security measures:"}),"\n",(0,i.jsx)(n.h3,{id:"chain-level-security",children:"Chain-Level Security"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Source Validation"}),": Verifies that messages come from trusted contracts"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Destination Validation"}),": Ensures messages are sent to the correct destination"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Request Authentication"}),": Only authorized contracts can initiate randomness requests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Nonce Tracking"}),": Prevents replay attacks by validating message nonces"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"randomness-security",children:"Randomness Security"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Multi-Source Aggregation"}),": Combines randomness from multiple providers for enhanced security"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Source Weighting"}),": Assigns different weights to different providers based on trust"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Threshold Requirements"}),": Ensures minimum number of active sources for valid randomness"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cryptographic Verification"}),": Verifies signatures and proofs when available"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"fallback-mechanisms",children:"Fallback Mechanisms"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Local Randomness Source"}),": Provides a fallback if cross-chain sources are unavailable"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Timeout Handling"}),": Detects and manages request timeouts"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Source Redundancy"}),": Uses multiple randomness sources for reliability"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Degraded Mode Operation"}),": Continues functioning with fewer sources if necessary"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"gas-and-fee-considerations",children:"Gas and Fee Considerations"}),"\n",(0,i.jsx)(n.p,{children:"Cross-chain operations involve multiple gas costs:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Source Chain Fees"}),": Cost to initiate the request (Sonic)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"LayerZero Fees"}),": Fee for the cross-chain message"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Destination Chain Fees"}),": Cost to process the request (Arbitrum)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Chainlink VRF Fee"}),": LINK token cost for using Chainlink VRF"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Return Message Fees"}),": Cost to send the result back to Sonic"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The system provides fee estimation functions to calculate expected costs."}),"\n",(0,i.jsx)(n.h2,{id:"integration-example",children:"Integration Example"}),"\n",(0,i.jsx)(n.p,{children:"Here's how a contract would integrate with the cross-chain randomness system:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:'// Example consumer on Sonic chain\ncontract CrossChainRandomnessConsumer {\n    OmniDragonVRFConsumer public vrfConsumer;\n    mapping(uint256 => bool) public pendingRequests;\n    \n    constructor(address _vrfConsumer) {\n        vrfConsumer = OmniDragonVRFConsumer(_vrfConsumer);\n    }\n    \n    function requestRandomness() external returns (uint256) {\n        // Generate unique request ID\n        uint256 requestId = uint256(keccak256(abi.encode(\n            block.timestamp, \n            msg.sender, \n            address(this)\n        )));\n        \n        // Record the request\n        pendingRequests[requestId] = true;\n        \n        // This will trigger the cross-chain flow\n        vrfConsumer.requestRandomness(address(this), requestId);\n        \n        return requestId;\n    }\n    \n    function fulfillRandomness(\n        uint256 _requestId, \n        uint256 _randomValue,\n        uint256 _round\n    ) external {\n        require(msg.sender == address(vrfConsumer), "Invalid sender");\n        require(pendingRequests[_requestId], "Unknown request");\n        \n        // Use randomness here\n        // ...\n        \n        // Clean up\n        delete pendingRequests[_requestId];\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"deployment-pipeline",children:"Deployment Pipeline"}),"\n",(0,i.jsx)(n.p,{children:"Deploying the cross-chain randomness system involves several steps:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Arbitrum Deployment"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Deploy ArbitrumVRFRequester"}),"\n",(0,i.jsx)(n.li,{children:"Create Chainlink VRF subscription"}),"\n",(0,i.jsx)(n.li,{children:"Fund subscription with LINK tokens"}),"\n",(0,i.jsx)(n.li,{children:"Add requester as consumer to subscription"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Sonic Deployment"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Deploy ChainlinkVRFIntegrator"}),"\n",(0,i.jsx)(n.li,{children:"Deploy OmniDragonVRFConsumer"}),"\n",(0,i.jsx)(n.li,{children:"Deploy additional integrators (drand, etc.)"}),"\n",(0,i.jsx)(n.li,{children:"Configure OmniDragonVRFConsumer with integrators and weights"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"LayerZero Configuration"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Set trusted remote addresses for both contracts"}),"\n",(0,i.jsx)(n.li,{children:"Configure gas limits and adapter parameters"}),"\n",(0,i.jsx)(n.li,{children:"Fund contracts with native tokens for gas fees"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"System Integration"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Connect SwapTriggerOracle to OmniDragonVRFConsumer"}),"\n",(0,i.jsx)(n.li,{children:"Authorize consumer contracts"}),"\n",(0,i.jsx)(n.li,{children:"Set up monitoring and fallback systems"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"monitoring-and-maintenance",children:"Monitoring and Maintenance"}),"\n",(0,i.jsx)(n.p,{children:"To ensure reliable operation of the cross-chain randomness system:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Chainlink Subscription"}),": Regularly monitor and top up the LINK balance"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"LayerZero Gas"}),": Maintain sufficient ETH for cross-chain messaging"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Request Timeouts"}),": Implement monitoring for stalled or failed requests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Source Health"}),": Track the status and reliability of each randomness source"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Gas Optimization"}),": Periodically review and optimize gas usage parameters"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var r=s(6540);const i={},t=r.createContext(i);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);